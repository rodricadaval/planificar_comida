<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Planificar Comida</title>
    <!-- jQuery -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Bootstrap select JS-->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <!-- DataTables JS-->
    <script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="js/bootstrap-select.js"></script>
    <!-- DataTables CSS -->
    <link href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css" rel="stylesheet">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="theme.css" rel="stylesheet">
    <!-- Bootstrap select CSS -->
    <link href="css/bootstrap-select.min.css" rel="stylesheet">
    <style type="text/css">
    body
    {
        font-family: ubuntu;
    }
    #busqueda_recetas
    {
        width: 300px; 
    }
    #muestra_recetas
    {
        min-height: 200px;
    }
    #elegir_turno
    {
        margin-top:50%;
        font-weight:bold;
        font-size:40px;
        font-style:italic;        
        color:grey;
    }
    #arrow_left
    {
        margin-right:10px; 
        font-size:40px; 
        vertical-align:sub;
        color: grey;
    }
    </style>
</head>

<body rolle="document">
    <nav class="navbar navbar-inverse  navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Que comemos?</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div  class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home <span class="sr-only">(current)</span></a></li>
                </ul>
                <form class="navbar-form navbar-left" role="search">
                    <div class="form-group">
                     <div class="input-group">
                    <span class="input-group-btn">
                    <button class="btn btn-primary" type="button"><span class="glyphicon glyphicon-search" aria-hidden="true"></button>
                    </span>
                      <input id="busqueda_recetas" type="text" class="form-control" placeholder="Busque recetas o ingrese el id de la misma">
                    </div><!-- /input-group -->
                </form>                
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                            <text style="font-weight:bold;"> Roberto Pereira</text><span class="caret"></span></a>
                        <ul class="dropdown-menu">                            
                            <li><a href="#">Mis Grupos</a></li>
                            <li><a href="#">Mis Recetas</a></li>
                            <li><a href="#">Planificar d&iacute;a</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">Mis datos</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="login.html">Desconectarse</a></li>
                        </ul>
                    </li>
                </ul>
                <p class="navbar-text navbar-right">
                    <span style="margin-right:10px;" class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                    <text style=" font-style:italic"> Logueado como</text>
                    <a href="#" class="navbar-link"></a>
                </p>
                <!-- <text style="font-weight:bold; text-transform:uppercase;"> Roberto Pereira</text></a></p> -->
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
    <div class="container theme-showcase" role="main">
        <!-- Main jumbotron for a primary marketing message or call to action -->
        <div class="jumbotron">
            <h1 style="text-align:center">Planifica tus Comidas</h1>
            <p style="text-align:center">Esto es un prototipo de como sería el Caso de Uso "Planificar Comidas"</p>
        </div>
        <div class="page-header">
            <h1>Comidas del día</h1>
        </div>
        <div class="row">
            <div class="col-sm-3">
                <select class="selectpicker" data-style="btn-primary">
                    <option value="0" selected>Seleccione tipo de receta</option>
                    <option value="d">Desayuno</option>
                    <option value="a">Almuerzo</option>
                    <option value="m">Merienda</option>
                    <option value="c">Cena</option>
                </select>
            </div>
            <!-- /.col-sm-3 -->
            <div class="col-sm-9">
                <div class="panel panel-primary" id="muestra_recetas">
                    <div class="panel-heading">
                        <h3 class="panel-title">Recetas</h3>
                    </div>
                    <div class="panel-body">
                        <div id="sugerencia" style="text-align:center; vertical-align:middle; min-height: 10px; margin-top:5%;" class="col-sm-12">
                        <span id="arrow_left" class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
                            <span id="elegir_turno">ELIJA ALGUN TURNO</span>
                        </div>
                        <table style="text-align:center;" cellpadding="0" cellspacing="0" border="0" class="display" id="dataTable">                        
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <button id="planificar_dia" style="float:right;" class="btn btn-success">Planificar</button>
            </div>
        </div>
        <div class="page-header">
            <h1>Recetas Sugeridas</h1>
        </div>        
        <br>
        <div class="row">
            <div class="col-md-6">
                <table class='table'>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Sugerencia</th>
                            <th>Calorias</th>
                            <th>Tipo</th>
                            <th>Rating</th>
                            <th><span class='glyphicon glyphicon-ok' aria-hidden='true'></span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Milanga con fritas</td>
                            <td>2500</td>
                            <td>Almuerzo</td>
                            <td>****</td>
                            <td>
                                <div class="checker">
                                    <span class="">
                        <input type='checkbox' id="receta_seleccionada" name='receta' value='1'>
                      </td>
                    </span>
                                </div>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Ensalada Ceaser</td>
                            <td>800</td>
                            <td>Almuerzo</td>
                            <td>**</td>
                            <td>
                                <input type='radio' name='receta' value='2'>
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Cuarto de Libre con Queso</td>
                            <td>over 9000 !</td>
                            <td>Cena</td>
                            <td>*****</td>
                            <td>
                                <input type='radio' name='receta' value='3'>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- Small modal -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Recete Elegida</h4>
                        </div>
                        <div class="modal-body">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Guardar Seleccion</button>
                        </div>
                    </div>
                </div>
            </div>

            <script type="text/javascript">
            jQuery(document).ready(function() {


                $('.selectpicker').selectpicker();

                $('.selectpicker option[value="0"]').attr('selected', 'selected');

                $('.selectpicker').selectpicker('refresh');              

                $('.selectpicker').on('change', function() {

                    $("#sugerencia").hide();
                    //Envio el tipo de comida a averiguar y recibo los datos type json (los datatables los necesitan así).
                    $.ajax({
                            url: 'obtenerRecetasDelTipo.php',
                            type: 'POST',
                            dataType: 'json',
                            data: {
                                tipo: $('.selectpicker option:selected').val()
                            },
                            success: function(data) {

                                console.log(data);

                                if (data == null) {
                                    data = [];
                                }

                                var dataTable = $("#dataTable").dataTable({
                                    "destroy": true,
                                    "aaData": data,
                                    "iDisplayLength": 25,
                                    "aoColumns": [{
                                        "sTitle": "ID Receta",
                                        "mData": "id_receta"
                                    }, {
                                        "sTitle": "Receta",
                                        "mData": "receta"
                                    }, {
                                        "sTitle": "Calorias",
                                        "mData": "calorias"
                                    }, {
                                        "sTitle": "Rating",
                                        "mData": "rating"
                                    }, {
                                        "sTitle": "Seleccion",
                                        "mData": "boton"
                                    }]

                                })

                            }
                        })
                        .fail(function() {
                            console.log("error");
                        })
                        .always(function() {
                            console.log("complete");
                        });

                });

                $('.container').on('click', '#boton_receta', function() {

                    var valor = $(this).val();

                    console.log(valor);

                    $("#myModal").modal("toggle");
                    $(".modal-body").html("Elegiste la receta: " + valor);

                });


                $(".container").on('click', '#boton_receta',function() {
                   
                   var attr = $(this).attr('checked');
                   if (typeof attr !== typeof undefined && attr !== false) {
                       $(this).removeAttr('checked');
                   }                 
                   else{
                      $(this).attr('checked', 'checked');
                   }
                });

                $('.container').on('click', '#planificar_dia', function() {

                    var texto = "Elegiste las recetas: ";
                    var attr2 = $(this).attr('checked');
                    var first = true;
                    $("#dataTable td input[type='checkbox']").each(function(index, el) {                      
                      //console.log(el);
                      attr2 = $(this).attr('checked');


                      if (typeof attr2 !== typeof undefined && attr2 !== false) { 
                          if (first) {texto += $(this).val(); first = false;} else{texto += ", " + $(this).val();}                                 
                      }
                    });

                    $("#myModal").modal("toggle");
                    $(".modal-body").html(texto);
                });

                $("#nueva_receta").on('click',function(event){
                    //console.log($(this).attr('url'));                    
                    $(location).attr('href', $(this).attr('url'));
                    return false;
                });


            });
            </script>
</body>

</html>
